<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, width=device-width">
    <title> Handling mass assignment with Active Admin |  ejholmes.github.com</title>
    <meta name="author" content="Eric Holmes" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js" type="text/javascript" charset="utf-8"></script>

    <link rel="stylesheet" href="/assets/application.css" type="text/css" media="all" />

    <link href="/atom.xml" rel="alternate" title="ejholmes.github.com" type="application/atom+xml" />

    <meta name="google-site-verification" content="mb6iga_W1c5xmxH3VZvk1sj-nMemSQ2ZqykpBk7vD3w" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
    <div id="page" class="container">
        <div id="header" class="clearfix">
            <a class="posts" href="/posts.html"><i class="icon-edit"></i> Posts</a>
        </div>
        <div id="content">
            

<article  class="detail" >
    <h1 class="title"><a href="/2012/04/22/handling-mass-assignment-with-active-admin.html">Handling mass assignment with Active Admin</a></h1>
    
        <p>With the recent <a href="https://github.com/blog/1068-public-key-security-vulnerability-and-mitigation">Github security vulnerability</a>,
a lot of people have been paying closer attention to security in their Rails
applications, mainly when dealing with <a href="http://guides.rubyonrails.org/security.html#mass-assignment">mass assignment</a>.</p>

<p>However, locking down mass assignment can be very inconvenient when dealing
with admin interfaces where you need to allow certain users to mass assign
attributes that a regular user shouldn't be able to do. Fortunately, there's
an easy way to get past this by using Rails 3.1's <a href="http://launchware.com/articles/whats-new-in-edge-scoped-mass-assignment-in-rails-3-1">scoped mass assignment</a></p>

<h3>Scoped Mass Assignment</h3>

<p>Scoped mass assignment allows you to assign a set of attributes to a certain
'scope' that you can then specify when calling <code>create</code> or <code>update_attributes</code>.
Essentially, it allows you to do something like this:</p>

<p>The above code will only allow the <code>published</code> attribute to be mass assigned if the
current user is an admin.</p>

<h3>Scoped Mass Assignment with Active Admin</h3>

<p>Scoped mass assignment works fine when we're writing the controllers ourselves,
but how do we assign a scope when using active admin, where controllers are
automatically created for us? Well, fortunately, active admin makes use of
<a href="https://github.com/josevalim/inherited_resources">inherited_resources</a>, which
provides a class method called <code>with_role</code>.</p>

<p>By appending a few lines of code to our active admin initializer, we can assign
the admin scope to all model calls while under the admin interface:</p>

<p>Now, whenever a post is created or updated by a user using the admin interface, the
<code>:admin</code> scope will be used, which will allow the <code>published</code> attribute to be
mass assigned.</p>

<p>If we had a <code>role</code> field on our AdminUser model we could even take this a step
further by overriding the <code>role_given?</code> and <code>as_role</code> methods:</p>

<p>Now, we can easily set the security for these roles in our model:</p>

<h3>Related Resources</h3>

<ul>
<li><a href="http://railscasts.com/episodes/237-dynamic-attr-accessible">Railscasts: #237 Dynamic attr_accessible</a></li>
<li><a href="http://launchware.com/articles/whats-new-in-edge-scoped-mass-assignment-in-rails-3-1">Rails 3.1 scoped mass assignment</a></li>
</ul>


    
    <div class="meta">Posted on <time>22 Apr 2012</time> in <span class="tags">Rails, Ruby, Active Admin</span></div>
</article>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ejholmes'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>


        </div>
        <section class="coderwall" data-coderwall-username="ejholmes" data-coderwall-orientation="vertical"></section>
    </div>
    <!-- Google Analytics -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-15555520-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<!-- Mixpanel -->
<script type="text/javascript">(function(d,c){var a,b,g,e;a=d.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"===d.location.protocol?"https:":"http:")+'//api.mixpanel.com/site_media/js/api/mixpanel.2.js';b=d.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b);c._i=[];c.init=function(a,d,f){var b=c;"undefined"!==typeof f?b=c[f]=[]:f="mixpanel";g="disable track track_links track_forms register register_once unregister identify name_tag set_config".split(" ");for(e=0;e<
g.length;e++)(function(a){b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,0)))}})(g[e]);c._i.push([a,d,f])};window.mixpanel=c})(document,[]);
mixpanel.init("5f9a122e25085cf0152ae5e5af773b27");</script>

    <link href="http://coderwall.com/stylesheets/jquery.coderwall.css" media="all" rel="stylesheet" type="text/css">
<script src="http://coderwall.com/javascripts/jquery.coderwall.js"></script>

</body>
</html>
